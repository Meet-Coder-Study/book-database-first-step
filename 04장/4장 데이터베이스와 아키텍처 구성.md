# 4장 데이터베이스와 아키텍처 구성
## 아키텍처란
- ‘아키텍처’란 시스템을 만들기 위한 물리 레벨의 조합을 의미하며, 이는 곧 하드웨어와 미들웨어의 구성을 가르킵니다.
- 또한 아키텍처를 통해 해당 시스템이 어떤 용도로 사용되고 무엇을 목적으로 설계되었는지 알 수 있습니다.

## 데이터베이스의 아키텍처
### Stand-alone(1980년대까지)
- 문자 그대로 데이터베이스가 동작하는 머신이 네트워크 연결 없이 독립되어 동작하는 구성입니다.
- 해당 DB를 사용하고 싶은 사용자는 DB서버가 설치된 장소까지 물리적으로 접근하여 사용해야합니다.
- 데이터베이스의 미들웨어와 애플리케이션의 소프트웨어는 같은 DB 서버에서 동작합니다.
- 이 같은 구조는 물리적으로 떨어진 장소에서 접근 할 수 없고 네트워크에 연결되지 않은 구조라 복수 사용자가 동시에 사용이 불가합니다. 또한 가용성과 확장성이 굉장히 떨어집니다.
- 가용성이 떨어진다는 것의 의미는 서버가 1대밖에 없는 구조의 시스템이라 해당 기기에 장애가 발생할 경우 배포중인 서비스가 중지된다는 것을 의미합니다.
- 확정성이 부족하다는 것의 의미는 실제 머신이 1대밖에 없다는 것은 머신 그자체의 성능을 올리는 것외에에는 성능 개선 수단이 존재하지 않는다는것을 의미합니다.
- 다만, 물리적으로 존재하는 서버로 돌아가기에 보안적인 측면과 구축이 굉장히 간단하다는 장점은 존재합니다.

### Client/Server(2000년대까지)
- 해당 설계는 **2계층 구성** 설계로도 불리며 DB서버에서는 DBMS가 동작하고 클라이언트에서는 업무 애플리케이션이 동작하는 분업제제로 볼 수 있습니다.
- 물리적으로 떨어진 장소에서 접속할 수 없다는 단점을 극복하기위해 네트워크를 연결시키면서 복수의 사용자가 DB에 접속 할 수 있게 되었습니다.
- 또한 네트워크를 연결할 경우 주로 기업 또는 조직 내의 닫히 네트워크(LAN)을 사용하여 보안상의 유리함을 취했습니다.

### Web 3계층(현재까지)
- 클라이언트와 데이터베이스 계층 사이에 ‘웹 서버 계층’과 ‘애플리케이션 계층’이 추가된 구조입니다.
- 웹 서버는 클라이언트로 부터 HTTP 요청을 직접 받아서 해당 요청을 애플리케이션 계층에 넘기고 그 요청에 대한 응답을 클라이언트에게 반환하는 역할을 수행합니다.
- 애플리케이션 계층은 비지니스 로직을 구현한 애플리케이션이 동작하는 층이며 웹 서버로부터 온 요청을 로직 처리하고, 필요한 경우 DB에 접속해서 데이터를 추출하고 이를 웹 서버로 반환합니다.

## DB 서버의 다중화 - 클러스터링
- 클러스터링이란 동일한 기능의 컴포넌트를 병렬화 시키는 작업을 말하며, 같은 기능을 수행하는 컴포넌트 여러개준비해서 해당 기능을 수행한다라는 뜻을 의미합니다.
- 서버의 측면에서는 동일한 기능의 서버를 여러개를 두고 동작을 시키면서 하나의 서버가 다운되어도 다른 서버가 동작합니다.
- 하지만 DB서버의 경우 서버가 데이터를 보존하는 **영속계층**이기 때문에 간단히 병렬화해서 서버 개수를 증가시키는 방법에는 고려해야하는 부분이 존재합니다.
- 근본적으로 DB서버와 일반 웹서버와의 차이점 중 가장 큰 부분은 위에서 언급한 **영속계층**이라는 점입니다.일반적으로 영구적으로 데이터를 저장해야하는 DB서버의 경우 데이터를 보존하는 외부 저장소를 사용합니다.
- 이러한 DB 서버 다중화의 기본적인 구성은 DB서버 2대와 저장소 한개의 형태입니다.
- 이러한 형태를 동작시킬 때 크게 두가지 방식으로 나누어집니다.
### Active-Active 방식
- 이름에서도 알 수 있듯이 존재하는 DB 서버를 모두 가동시키는 방식입니다.즉 복수개의 DB 서버가 동시에 동작하고 있기에 한 대가 다운되어 동작 불능이 되어도 남은 서버가 처리를 계속 진행하여 전체 시스템이 유지됩니다.하지만 당연히 가격이 제일 비싼 구성입니다.
### Active-Standby 방식
- 평소에는 한개(또는 여러개?)의 DB서버를 동작시키고 만약 현재 동작하는 서버가 다운이 되면 Standby하고 있는 또 다른 DB서버가 동작하는 방식입니다.이러한 구조는 크게 두가지 방식으로 나누어집니다.
1. Cold-Standby : 평소에는 StandBy DB가 작동하지 않다가 Active DB가 다운된 시점에 작동하는 구성입니다.
2. Hot-Standby : 평소에도 Standby DB가 작동하는 구성입니다.

## DB 서버의 다중화 - 리플리케이션
- 앞에서 설명한 클러스터 구성에서는 DB서버 부분은 다중화 할 수 있어도 저장소 부분은 다중화 할 수 없어서 데이터를 다중화하지 않는 공통적인 단점이 있습니다. **즉, 저장소에 문제가 생기면 데이터를 잃는 구조입니다.**
- 이런 상황을 대처하기 위한 클러스터 구성이 ‘리플리케이션’입니다.이는 DB 서버와 저장소 세트를 복수로 준비하는 것을 말합니다.
- 이러한 리플리케이션을 적용할때 주의점은 항상 Active 서버의 저장소와 Standby 서버의 저장소에도 데이터를 최신상태로 동기화해서 정합성을 유지해야하는 것입니다.


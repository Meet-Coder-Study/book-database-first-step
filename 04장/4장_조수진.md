# 4장. 데이터베이스와 아키텍처 구성

### 아키텍처?

시스템을 구성하기 위한 컴포턴트의 조합(ex. 어떤 서버, 어떤 저장소, 네트워크 기기 등)

비용에 아주 밀접한 관련(고가용성, 신뢰성, 성능 등과 비용은 반비례!)

→ 요구되는 목적과 기능을 고려해서 적절한 아키텍처를 선택해야함

### 아키텍처의 역사

- stand alone: 네트워크 접속없이 독립되어 동작하는 방식

    → 물리적으로 떨어진 장소에서 접근 불가, 동시 작업 불가, 가용성이 낮고, 확장성 부족

    → 보안이 높다는 장점은 있음

- 클라이언트/서버: DB서버에 접속하는 어플리케이션과 DB서버를 클라이언트/서버로 분리

    → 물리적으로 떨어진 곳에서 접근 가능, 동시 작업 가능

    → 클라이언트 측에 있는 어플리케이션을 관리하는 비용이 크다

    → 여전히 가용성과 확장성은 부족

- Web 3계층: 클라이언트로 브라우저, 서버에 웹서버, 애플리케이션 서버, DB 서버 3계층으로 구성

    → 어플리케이션을 어플리케이션 서버에서 관리하고 비용이 적다

    → 여전히 가용성과 확장성은 부족

### 가용성과 확장성

- 가용성: 사용자 입장에서 서비스가 장애없이 사용가능한 정도
- 신뢰성: 하드웨어나 소프트웨어가 고장나는 빈도나 고장 기간

**가용성을 높이는 2가지 전략**

- scale up(한계가 있음)
- scale out

**클러스터**

클러스터: 어떤 것들의 집합을 의미

→ 동일한 기능의 컴포넌트를 병렬화하는 것

⇒ 클러스터 구성으로 시스템의 가동률을 높이는 것을 여유도(redundancy)를 확보한다 or 다중화

서버가 증가할 수록 장애 발생률은 줄어들지만, 가동률 향상 폭이 크게 줄어든다(= 수확체감의 법칙)

**단일 장애점**

다중화되어 있지 않아서 시스템 전체 서비스의 걔속성에 영향을 주는 컴포넌트

단일 장애점의 신뢰성이 시스템 전체의 가용성을 결정한다

### DB 서버의 다중화 - 클러스터링

DB는 영속 계층이기 때문에 다중화 시, 데이터의 정합성 유지가 어렵다

**일반적인 다중화**

저장소 한 개 + DB 서버 여러개

**클러스터링의 방식**

- Active-Active: 클러스터를 구성하는 컴포넌트를 동시에 가동

    → 다운 시간이 짧다, 성능이 좋아진다, 저장소가 병목이 될 수 있다(서버 컴포넌트가는다고 성능이 비례 증가하진 않음)

- Active-StandBy: 한 컴포넌트만 실제 가동 남은 것은 대기

    (Active 서버에 Heartbeat체크로 Active 서버가 죽었는지 확인함)

    - Hot-StandBy: 평소에도 StandBy DB가 작동
    - Cold-StandBy: 평소에는 작동하지 않다가 Active가 다운되면 작동

→ 하지만 클러스터링만 적용했을 시, 저장소 부분에 문제가 생기면 데이터를 잃게 됨

### DB 서버와 데이터의 다중화 - 리플리케이션

(저장소 + 서버) 묶음을 복수로 구성 → 저장소도 다중화

물리적 공간을 따로 배치 (RAID: 디스크를 다중화하는 방식도 있기는 함!)

마스터-슬레이브 방식(멀티 마스터는 찾아보기 어렵)

**장점**

- 저장소에 문제가 생겨도 가용성을 높게 유지할 수 있음

    → 재난 대책에 탁월

**단점**

- Active와 StandBy측의 동기화 필요
- 부하 분산 가능(손자, 증손자 세트를 만들고, 속도가 중요하지 않은 데이터를 자손들에게 요청 시)

### Shared Nothing - 클러스터링의 새로운 방식(샤딩)

기존 클러스터링 방식은 Shard Disk 방식 달리 저장소를 분할

Active-Active Shared Disk 클러스터링은 서버를 늘려도 처리율의 한계가 있다(DB 서버 간 정보 공유 오버헤드)

→ Shared Nothing 등장

⇒ 서버+저장소 세트가 늘어나면 병렬처리로 성능이 선형적으로 증가

하지만, 정보가 분산되어 있기 때문에 집계하는 정리 서버가 필요하고 한 서버가 다운되었을 때 그 데이터에 접근이 불가능하다. 또한 구성이 복잡하다.

**Tip! 커버링:** Shared Nothing 클러스터 구조에서 하나의 서버가 다운되었을 때 이를 다른 서버가 계속 처리할 수 있게 하는 방식

### 정리

- Stand-alone
- 클러스터링
    - Shared Nothing
    - Shared Disk
        - Active-Active
        - Active-StandBy
            - Hot-StandBy
            - Cold-StandBy
- 리플리케이션
    - 마스터 슬레이브
    - 멀티 마스터

아키텍처는 시스템이 충족해야 하는 기본 요건에 따라 결정된다. 가용성, 신뢰성, 재해대책, 성능, 보안 등 기능적이지 않은 요건에 어느 정도 수준으로 요구할 것인지에 따라 선택해야 할 아키텍처 구조가 바뀐다.

한 번 정한 아키텍처는 바꾸기가 무진장 힘들다.

그러핟고 무조건 고기능의 아키텍처를 사용하면 금전적 비용, 시간, 인적 자원등이 크게 증가한다.

잘 고려해서 최적의 아키텍처를 선택하시길.

**Tip! 리플리케이션 기능을 가진 DBMS는 보통 비용이 비싼데 MySQL은 에디션 상관없이 기본 기능으로 제공~**
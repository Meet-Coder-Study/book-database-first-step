# 7장 트랜잭션과 동시성 제어

ACID

[ 원자성 (Atomicity) ]

- 데이터 변경을 수반하는 일련의 데이터 조작이 전부 성공할지 실패할지를 보증하는 구조
- 하나의 트랜잭션 안에서 실행되는 모든 절차는 모두 수행(COMMIT)되거나 모두 복구(ROLLBACK)된다.
→ COMMIT 된 것 이외는 ROLLBACK을 해야한다.

[ 일관성 (Consistency) ]

- 일련의 데이터 조작 전후에 그 상태를 유지하는 것을 보증

[ 격리성 (Isolation) ]

- 일련의 데이터 조작을 복수 사용자가 동시에 실행해도 각각의 처리가 모순없이 실행되는 것을 보증
→ 모순 X : 복수의 트랜잭션이 순섣대로 실행되는 경우와 같은 결과를 얻을 수 있는 상태
- 동시에 자원에 접근하여 수정하는 경우에 Lock을 걸어서 후속 처리를 블록할 수 있다.

### 격리 수준

격리 수준 : 다른 트랜잭션의 영향을 받는 것을 허용하는 4개의 격리 단계

- 커밋되지 않은 읽기 (Read Uncommitted) : COMMIT 되지 않은 데이터도 조회가 가능
- 커밋된 읽기 (Read Committed) : COMMIT 된 데이터만 조회 가능
- 반복 읽기 (Repeatable Read) : 한 트랜잭션 안에서 조회하는 데이터는 항상 동일한 값이 조회됨
- 직렬화 가능 (Serializable) : 작업 중인 트랜잭션이 종료될 때까지 어떤 작업도 허용되지 않음

### 격리 수준 완화에 따라 일어나는 현상

- 더티 읽기 : 어떤 트랜잭션이 커밋되기 전에 다른 트랜잭션에서 데이터를 읽는 현상
- 애매한 읽기 : 어떤 트랜잭션이 이전에 읽어 들인 데이터를 다시 일어 들일 때 데이터의 2회 이후의 결과가 1회 때와 다른 현상. (다른 트랜잭션에서 커밋된 데이터를 읽어들이는 경우)
- 팬텀 읽기 : 2번의 SELECT 작업중 INSERT 혹은 DELETE 작업으로 인해 조회되는 데이터가 추가되거나 사라지는 현상


[ 지속성 (Durability) ]

- 일련의 데이터 조작을 완료하고 완료 통지를 사용자가 받는 시점에서 그 조작이 영구적이 되어 그 결과를 잃지않는 것
- 시스템에 장애가 생겼을 때도 견딜 수 있음을 의미
→ 트랜잭션 조작을 하드 디스크에 로그로 기록하고, 장애 발생 시 그 로그를 활용해 장애 이전으로 복원

### 커밋 이전에 다른 커넥션에서 변경된 데이터가 보이는 경우

- DDL에 따른 암묵적인 커밋 : MySQL 이나 Oracle에서는 CREATE TABLE 같은 DDL 실행 시 암묵적인 커밋이 발생한다. 따라서 하나의 커넥션에서 실행된 DDL문이 성공하면 다른 커넥션에서도 참조가 가능하다.
- 오토커밋 설정 (MySQL, PostgreSQL, SQL server 등에서 default 설정)
    1. 하나의 SQL 문이 하나의 트랜잭션으로 구분
    2. 사용자가 커밋 또는 롤백을 실행하기까지가 하나의 트랜잭션이 된다. 

### MVCC에 따른 MySQL의 특성

### 잠금 타임아웃과 교착상태
